{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Certidão de Destruição - 6º BPM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        /* Margens ideais para impressão A4 Paisagem */
        @page { size: landscape; margin: 10mm; }
        
        body { font-family: "Times New Roman", Times, serif; color: #000; background: #fff; }
        
        .container-report { max-width: 98%; margin: auto; padding: 15px; }
        
        .header-doc { border-bottom: 3px double #1a3a2a; padding-bottom: 10px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background-color: #f8f9fa !important; border: 1px solid #333 !important; padding: 8px; text-align: center; font-size: 0.85rem; }
        td { border: 1px solid #333 !important; padding: 6px; font-size: 0.85rem; vertical-align: middle; }
        
        .vara-header { background-color: #e9ecef; border-left: 6px solid #1a3a2a; padding: 8px 15px; margin-top: 25px; }
        
        .assinatura-line { border-top: 1px solid #000; width: 80%; margin: 60px auto 10px auto; }
        
        @media print {
            .no-print { display: none; }
            .page-break { page-break-after: always; }
        }
    </style>
</head>
<body>

<div class="container-report">
    <div class="header-doc row align-items-center">
        <div class="col-1 text-center">
            <img src="{% static 'img/brasao_pmpr.svg' %}" style="height: 70px;">
        </div>
        <div class="col-9 text-center">
            <h4 class="fw-bold m-0 text-uppercase">Polícia Militar do Paraná</h4>
            <h6 class="text-uppercase">6º Batalhão de Polícia Militar - Seção de Gestão de Custódia</h6>
            <h5 class="mt-2 fw-bold text-decoration-underline">Certidão de Destruição de Entorpecentes</h5>
        </div>
        <div class="col-2 text-end small">
            <p class="m-0"><b>Emissão:</b> {% now "d/m/Y" %}</p>
            <p class="m-0"><b>Lote:</b> {{ itens.0.lote.identificador }}</p>
        </div>
    </div>

    <div class="my-4 p-2">
        <p class="text-justify lh-lg">
            Certifico, para os devidos fins de direito, que nesta data, em estrito cumprimento à autorização judicial, procedeu-se a destruição das substâncias entorpecentes abaixo relacionadas. O procedimento foi realizado sob a supervisão da equipe de custódia do 6º BPM, conforme os protocolos legais de preservação da cadeia de custódia.
        </p>
    </div>

    {% regroup itens by noticiado.ocorrencia.vara as vara_list %}

    {% for vara in vara_list %}
        <div class="vara-header shadow-sm">
            <h6 class="fw-bold m-0 text-uppercase"><i class="bi bi-bank me-2"></i> Juízo: {{ vara.list.0.noticiado.ocorrencia.get_nome_vara_formal }}</h6>
        </div>
        
        <table class="table-sm">
            <thead>
                <tr>
                    <th style="width: 10%;">Data</th>
                    <th style="width: 15%;">BOU</th>
                    <th style="width: 20%;">Processo</th>
                    <th style="width: 20%;">Noticiado</th>
                    <th style="width: 15%;">Substância</th>
                    <th style="width: 10%;">Peso</th>
                    <th style="width: 10%;">Ofício</th>
                </tr>
            </thead>
            <tbody>
                {% for item in vara.list %}
                <tr>
                    <td class="text-center">{{ item.data_incineracao|date:"d/m/Y" }}</td>
                    <td class="text-center fw-bold">{{ item.noticiado.ocorrencia.bou }}</td>
                    <td class="text-center">{{ item.noticiado.ocorrencia.processo }}</td>
                    <td>{{ item.noticiado.nome|upper }}</td>
                    <td class="text-center">{{ item.get_substancia_display }}</td>
                    <td class="text-center fw-bold">{{ item.peso_real }} {{ item.get_unidade_display }}</td>
                    <td class="text-center">{{ item.n_oficio|default:"-" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endfor %}

    <div class="row mt-5">
        <div class="col-6 text-center">
            <div class="assinatura-line"></div>
            <p class="fw-bold">Responsável pela Custódia - 6º BPM</p>
        </div>
        <div class="col-6 text-center">
            <div class="assinatura-line"></div>
            <p class="fw-bold">Oficial Supervisor - PMPR</p>
        </div>
    </div>
</div>

<script>window.print();</script>
</body>
</html>