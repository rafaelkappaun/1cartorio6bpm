{% load static %} 
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatório de Incineração - 6º BPM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Estilos para tela */
        body { background-color: #f8f9fa; font-family: "Times New Roman", Times, serif; }
        
        .folha-a4 {
            background: white;
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 20px auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .cabecalho {
            text-align: center;
            border-bottom: 2px solid #000;
            margin-bottom: 25px;
            padding-bottom: 10px;
        }

        .brasao { width: 70px; height: auto; margin-bottom: 10px; }
        
        .titulo-relatorio {
            font-weight: bold;
            text-transform: uppercase;
            margin: 20px 0;
            text-decoration: underline;
        }

        table { font-size: 11px !important; }
        
        .assinatura-espaco {
            margin-top: 60px;
            text-align: center;
        }

        /* Configurações de Impressão */
        @media print {
            body { background: white !important; margin: 0; padding: 0; }
            .no-print { display: none !important; }
            .folha-a4 {
                width: 100%;
                margin: 0;
                box-shadow: none;
                padding: 10mm;
            }
            .table-dark { 
                background-color: #212529 !important; 
                color: white !important; 
                -webkit-print-color-adjust: exact; 
                print-color-adjust: exact; 
            }
        }
    </style>
</head>
<body>

<div class="container no-print mt-4">
    <div class="card shadow-sm border-0 p-3 bg-dark text-white">
        <form method="GET" class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="small fw-bold">Vara Judicial</label>
                 <select name="vara" class="form-select form-select-sm">
                     <option value="">Todas as Varas</option>
                     <option value="VARA_01" {% if filtros.vara == "VARA_01" %}selected{% endif %}>1ª Vara Criminal</option>
                     <option value="VARA_02" {% if filtros.vara == "VARA_02" %}selected{% endif %}>2ª Vara Criminal</option>
                     <option value="VARA_03" {% if filtros.vara == "VARA_03" %}selected{% endif %}>3ª Vara Criminal</option>
                 </select>
            </div>
            <div class="col-md-3">
                <label class="small fw-bold">Substância</label>
                <select name="substancia" class="form-select form-select-sm">
                    <option value="">Todas as Substâncias</option>
                    {% for valor, nome in drogas_lista %}
                        <option value="{{ valor }}" {% if filtros.substancia == valor %}selected{% endif %}>{{ nome }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label class="small fw-bold">Mês Referência</label>
                <select name="mes" class="form-select form-select-sm">
                    <option value="">Todos</option>
                    <option value="1" {% if filtros.mes == "1" %}selected{% endif %}>Janeiro</option>
                    <option value="2" {% if filtros.mes == "2" %}selected{% endif %}>Fevereiro</option>
                    <option value="3" {% if filtros.mes == "3" %}selected{% endif %}>Março</option>
                    <option value="12" {% if filtros.mes == "12" %}selected{% endif %}>Dezembro</option>
                </select>
            </div>
            <div class="col-md-4 d-flex gap-2">
                <button type="submit" class="btn btn-primary btn-sm flex-grow-1">Filtrar</button>
                <button onclick="window.print()" type="button" class="btn btn-success btn-sm flex-grow-1">Imprimir / PDF</button>
                <a href="{% url 'painel' %}" class="btn btn-outline-light btn-sm">Voltar</a>
            </div>
        </form>
    </div>
</div>

<div class="folha-a4">
    <div class="cabecalho">
        <img src="{% static 'img/brasao_pmpr.svg' %}" style="height: 80px;" class="me-3">
        <h6 class="mb-0 fw-bold">ESTADO DO PARANÁ</h6>
        <h6 class="mb-0">POLÍCIA MILITAR - 5º COMANDO REGIONAL</h6>
        <h6 class="mb-0">6º BATALHÃO DE POLÍCIA MILITAR - CASCAVEL/PR</h6>
    </div>

    <div class="text-center">
        <h5 class="titulo-relatorio">
    Relação de Materiais para Incineração<br>
    <small class="text-muted fs-6" style="text-decoration: none; display: block; margin-top: 5px;">
        {% if filtros.vara == "VARA_01" %}1ª VARA CRIMINAL
        {% elif filtros.vara == "VARA_02" %}2ª VARA CRIMINAL
        {% elif filtros.vara == "VARA_03" %}3ª VARA CRIMINAL
        {% else %}GERAL UNIDADE{% endif %}
    </small>
</h5>
    </div>

    <p class="text-end mb-4">Cascavel/PR, {{ data_hoje|date:"d" }} de {{ data_hoje|date:"F" }} de {{ data_hoje|date:"Y" }}.</p>

    <table class="table table-bordered table-sm table-striped align-middle">
        <thead class="table-dark text-center">
            <tr>
                <th width="15%">Lote/Sacola</th>
                <th width="15%">BOU</th>
                <th width="25%">Ofício/Vara</th>
                <th width="20%">Substância</th>
                <th width="25%">Peso/Qtd Real</th>
            </tr>
        </thead>
        <tbody>
            {% for item in itens %}
            <tr>
                <td class="text-center fw-bold">{{ item.lote }}</td>
                <td class="text-center">{{ item.bou }}</td>
                <td>
                    <div class="fw-bold">{{ item.n_oficio }}</div>
                    <div class="small text-muted" style="font-size: 0.85em;">{{ item.vara }}</div>
                </td>
                <td>{{ item.substancia }}</td>
                <td class="text-end fw-bold">{{ item.peso_real|floatformat:2 }} g {{ item.get_unidade_display }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-center p-4 text-muted">Nenhum registro encontrado para os filtros selecionados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="row mt-4">
        <div class="col-6">
            <h6 class="fw-bold border-bottom pb-1">RESUMO DO LOTE:</h6>
            <table class="table table-sm table-borderless">
                {% for r in resumo %}
                <tr>
                    <td class="py-0">{{ r.substancia }}</td>
                    <td class="text-end fw-bold py-0">
                        {{ r.total_massa|floatformat:2 }} 
                        {% if r.unidade == 'G' %}g{% elif r.unidade == 'U' %}un{% else %}pés{% endif %}
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
        <div class="col-6 text-end">
            <p class="small text-muted">Total de registros: {{ itens.count }}</p>
        </div>
    </div>

    <div class="assinatura-espaco">
        <p class="mb-0">_________________________________________________________</p>
        <p class="mb-0 fw-bold">NOME DO ENCARREGADO - POSTO/GRAD</p>
        <p class="small">Encarregado da Custódia de Entorpecentes - 6º BPM</p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>