{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Inventário Geral - 6º BPM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @page { size: A4 landscape; margin: 10mm; }
        body { background-color: #f8f9fa; font-family: "Times New Roman", serif; }
        
        .folha-a4 { 
            background: white; 
            width: 277mm; 
            min-height: 190mm; 
            padding: 15mm; 
            margin: 10px auto; 
            box-shadow: 0 0 5px rgba(0,0,0,0.1); 
        }
        
        .cabecalho { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            border-bottom: 2px solid #000; 
            margin-bottom: 20px; 
            padding-bottom: 10px; 
        }
        
        .brasao { width: 70px; height: auto; margin-right: 20px; }
        
        .titulo-relatorio { 
            font-weight: bold; 
            text-transform: uppercase; 
            text-decoration: underline; 
            text-align: center;
            margin-bottom: 20px;
        }
        
        table { font-size: 11px !important; width: 100%; }
        .table-dark-custom { background-color: #343a40 !important; color: white !important; }
        
        @media print { 
            .no-print { display: none !important; } 
            .folha-a4 { box-shadow: none; margin: 0; width: 100%; } 
        }
    </style>
</head>
<body>

<div class="container no-print mt-4">
    <div class="card shadow-sm border-0 p-3 bg-dark text-white">
        <form method="GET" class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="small fw-bold">Vara Judicial</label>
                <select name="vara" class="form-select form-select-sm">
                    <option value="">Todas as Varas</option>
                    <option value="VARA_01" {% if filtros.vara == "VARA_01" %}selected{% endif %}>1ª Vara Criminal</option>
                    <option value="VARA_02" {% if filtros.vara == "VARA_02" %}selected{% endif %}>2ª Vara Criminal</option>
                    <option value="VARA_03" {% if filtros.vara == "VARA_03" %}selected{% endif %}>3ª Vara Criminal</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="small fw-bold">Substância</label>
                <select name="substancia" class="form-select form-select-sm">
                    <option value="">Todas</option>
                    {% for valor, nome in drogas_lista %}<option value="{{ valor }}" {% if filtros.substancia == valor %}selected{% endif %}>{{ nome }}</option>{% endfor %}
                </select>
            </div>
            <div class="col-md-4 d-flex gap-2">
                <button type="submit" class="btn btn-primary btn-sm flex-grow-1">Filtrar</button>
                <button onclick="window.print()" type="button" class="btn btn-success btn-sm flex-grow-1">Imprimir / PDF</button>
                <a href="{% url 'painel' %}" class="btn btn-outline-light btn-sm">Voltar</a>
            </div>
        </form>
    </div>
</div>

<div class="folha-a4">
    <div class="cabecalho">
        <img src="{% static 'img/brasao_pmpr.svg' %}" alt="Brasão PMPR" class="brasao">
        <div class="text-center">
            <h6 class="mb-0 fw-bold">ESTADO DO PARANÁ</h6>
            <h6 class="mb-0">POLÍCIA MILITAR - 5º COMANDO REGIONAL</h6>
            <h6 class="mb-0">6º BATALHÃO DE POLÍCIA MILITAR - CASCAVEL/PR</h6>
        </div>
    </div>

    <h5 class="titulo-relatorio">Inventário Geral de Materiais Custodiados</h5>

    <table class="table table-bordered table-sm align-middle">
        <thead class="table-dark-custom text-center">
            <tr>
                <th>Status</th>
                <th>Lote</th>
                <th>BOU</th>
                <th>Vara / Ofício</th>
                <th>Substância</th>
                <th>Peso/Qtd</th>
            </tr>
        </thead>
        <tbody>
            {% if pendentes %}
            <tr class="table-warning"><td colspan="6" class="fw-bold">PENDENTES DE CONFERÊNCIA</td></tr>
            {% for item in pendentes %}
            <tr>
                <td class="text-center">PENDENTE</td>
                <td class="text-center">-</td>
                <td class="text-center">{{ item.noticiado.ocorrencia.bou }}</td>
                <td>{{ item.noticiado.ocorrencia.get_vara_display }} / {{ item.n_oficio|default:"-" }}</td>
                <td>{{ item.get_substancia_display }}</td>
                <td class="text-end fw-bold">{{ item.peso_estimado|floatformat:2 }} {{ item.get_unidade_display }}</td>
            </tr>
            {% endfor %}
            {% endif %}

            {% if no_cofre %}
            <tr class="table-info"><td colspan="6" class="fw-bold">NO COFRE</td></tr>
            {% for item in no_cofre %}
            <tr>
                <td class="text-center">NO COFRE</td>
                <td class="text-center">{{ item.lote.identificador|default:"-" }}</td>
                <td class="text-center">{{ item.noticiado.ocorrencia.bou }}</td>
                <td>{{ item.noticiado.ocorrencia.get_vara_display }} / {{ item.n_oficio|default:"-" }}</td>
                <td>{{ item.get_substancia_display }}</td>
                <td class="text-end fw-bold">{{ item.peso_real|floatformat:2 }} {{ item.get_unidade_display }}</td>
            </tr>
            {% endfor %}
            {% endif %}

            {% if prontos %}
            <tr class="table-primary"><td colspan="6" class="fw-bold">PRONTOS PARA QUEIMA</td></tr>
            {% for item in prontos %}
            <tr>
                <td class="text-center">PRONTO QUEIMA</td>
                <td class="text-center">{{ item.lote.identificador|default:"-" }}</td>
                <td class="text-center">{{ item.noticiado.ocorrencia.bou }}</td>
                <td>{{ item.noticiado.ocorrencia.get_vara_display }} / {{ item.n_oficio|default:"-" }}</td>
                <td>{{ item.get_substancia_display }}</td>
                <td class="text-end fw-bold">{{ item.peso_real|floatformat:2 }} {{ item.get_unidade_display }}</td>
            </tr>
            {% endfor %}
            {% endif %}

            {% if incinerados %}
            <tr class="table-danger"><td colspan="6" class="fw-bold">INCINERADOS</td></tr>
            {% for item in incinerados %}
            <tr>
                <td class="text-center">INCINERADO</td>
                <td class="text-center">{{ item.lote.identificador|default:"-" }}</td>
                <td class="text-center">{{ item.noticiado.ocorrencia.bou }}</td>
                <td>{{ item.noticiado.ocorrencia.get_vara_display }} / {{ item.n_oficio|default:"-" }}</td>
                <td>{{ item.get_substancia_display }}</td>
                <td class="text-end fw-bold">{{ item.peso_real|floatformat:2 }} {{ item.get_unidade_display }}</td>
            </tr>
            {% endfor %}
            {% endif %}
        </tbody>
    </table>

    <div class="row mt-5 pt-5 text-center">
        <div class="col-12">
            <p>_________________________________________________________</p>
            <p class="fw-bold">NOME DO ENCARREGADO - POSTO/GRAD</p>
            <p class="small">Encarregado da Custódia de Entorpecentes - 6º BPM</p>
        </div>
    </div>
</div>
</body>
</html>